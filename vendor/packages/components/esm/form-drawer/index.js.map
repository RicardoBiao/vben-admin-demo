{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["form-drawer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Button, Drawer, Space } from 'ant-design-vue'\r\nimport type { DrawerProps } from 'ant-design-vue/lib/drawer'\r\nimport { FormProvider, FragmentComponent } from '@formily/vue'\r\nimport { observer } from '@formily/reactive-vue'\r\nimport type { IMiddleware } from '@formily/shared'\r\nimport { isNum, isStr, isBool, isFn, applyMiddleware } from '@formily/shared'\r\nimport { toJS } from '@formily/reactive'\r\nimport type { Form, IFormProps } from '@formily/core'\r\nimport { createForm } from '@formily/core'\r\nimport type { Component, VNode } from 'vue'\r\nimport { h, defineComponent, Teleport, createApp } from 'vue'\r\nimport { stylePrefix } from '../__builtins__/configs'\r\n\r\nimport {\r\n  isValidElement,\r\n  resolveComponent,\r\n  createPortalProvider,\r\n  getProtalContext,\r\n  loading,\r\n} from '../__builtins__/shared'\r\n\r\nconst PORTAL_TARGET_NAME = 'FormDrawerFooter'\r\n\r\ntype FormDrawerRenderer = VNode | ((form: Form) => VNode)\r\n\r\ntype DrawerTitle = string | number | Component | VNode | (() => VNode)\r\n\r\nconst isDrawerTitle = (props: any): props is DrawerTitle => {\r\n  return isNum(props) || isStr(props) || isBool(props) || isValidElement(props)\r\n}\r\n\r\nconst getDrawerProps = (props: any): IDrawerProps => {\r\n  if (isDrawerTitle(props)) {\r\n    return {\r\n      title: props,\r\n    } as IDrawerProps\r\n  } else {\r\n    return props\r\n  }\r\n}\r\n\r\nexport interface IFormDrawer {\r\n  forOpen(middleware: IMiddleware<IFormProps>): IFormDrawer\r\n  forConfirm(middleware: IMiddleware<Form>): IFormDrawer\r\n  forCancel(middleware: IMiddleware<Form>): IFormDrawer\r\n  open(props?: IFormProps): Promise<any>\r\n  close(): void\r\n}\r\n\r\nexport interface IDrawerProps extends DrawerProps {\r\n  onOk?: (event?: MouseEvent) => void | boolean\r\n  onClose?: (event?: MouseEvent) => void | boolean\r\n  loadingText?: string\r\n}\r\n\r\nexport function FormDrawer(\r\n  title: IDrawerProps,\r\n  id: string,\r\n  renderer: FormDrawerRenderer\r\n): IFormDrawer\r\nexport function FormDrawer(\r\n  title: IDrawerProps,\r\n  renderer: FormDrawerRenderer\r\n): IFormDrawer\r\nexport function FormDrawer(\r\n  title: DrawerTitle,\r\n  id: string,\r\n  renderer: FormDrawerRenderer\r\n): IFormDrawer\r\nexport function FormDrawer(\r\n  title: DrawerTitle,\r\n  renderer: FormDrawerRenderer\r\n): IFormDrawer\r\n\r\nexport function FormDrawer(\r\n  title: DrawerTitle | IDrawerProps,\r\n  id: string | symbol | FormDrawerRenderer,\r\n  renderer?: FormDrawerRenderer\r\n): IFormDrawer {\r\n  if (isFn(id) || isValidElement(id)) {\r\n    renderer = id as FormDrawerRenderer\r\n    id = 'form-drawer'\r\n  }\r\n\r\n  const prefixCls = `${stylePrefix}-form-drawer`\r\n  const env = {\r\n    root: document.createElement('div'),\r\n    form: null,\r\n    promise: null,\r\n    app: null,\r\n    instance: null,\r\n    openMiddlewares: [],\r\n    confirmMiddlewares: [],\r\n    cancelMiddlewares: [],\r\n  }\r\n\r\n  document.body.appendChild(env.root)\r\n  const props = getDrawerProps(title)\r\n\r\n  const drawerProps = {\r\n    ...props,\r\n    width: '40%',\r\n    onClose: () => {\r\n      props.onClose?.()\r\n      env.app?.unmount()\r\n      env.instance = null\r\n      env.app = null\r\n      env.root?.parentNode?.removeChild(env.root)\r\n      env.root = undefined\r\n    },\r\n  }\r\n\r\n  const DrawerContent = observer(\r\n    defineComponent({\r\n      setup() {\r\n        return () =>\r\n          h(\r\n            FragmentComponent,\r\n            {},\r\n            {\r\n              default: () => resolveComponent(renderer, { form: env.form }),\r\n            }\r\n          )\r\n      },\r\n    })\r\n  )\r\n\r\n  const renderDrawer = (\r\n    visible = true,\r\n    resolve?: () => any,\r\n    reject?: () => any\r\n  ) => {\r\n    if (!env.instance) {\r\n      const ComponentConstructor = defineComponent({\r\n        props: ['drawerProps'],\r\n        data() {\r\n          return {\r\n            visible: false,\r\n          }\r\n        },\r\n        render() {\r\n          const {\r\n            onOk,\r\n            onClose,\r\n            title,\r\n            footer,\r\n            okText = '确定',\r\n            okType = 'primary',\r\n            okButtonProps,\r\n            cancelButtonProps,\r\n            cancelText = '取消',\r\n            ...drawerProps\r\n          } = this.drawerProps\r\n          return h(\r\n            Drawer,\r\n            {\r\n              class: prefixCls,\r\n              ...drawerProps,\r\n              visible: this.visible,\r\n              'onUpdate:visible': (val) => {\r\n                this.visible = val\r\n              },\r\n              onClose: (e) => {\r\n                if (onClose?.(e) !== false) {\r\n                  reject?.()\r\n                }\r\n              },\r\n              onOk: (e) => {\r\n                if (onOk?.(e) !== false) {\r\n                  resolve?.()\r\n                }\r\n              },\r\n            },\r\n            {\r\n              default: () =>\r\n                h(\r\n                  FormProvider,\r\n                  {\r\n                    form: env.form,\r\n                  },\r\n                  {\r\n                    default: () => [\r\n                      h(\r\n                        'div',\r\n                        {\r\n                          class: [`${prefixCls}-body`],\r\n                        },\r\n                        h(DrawerContent)\r\n                      ),\r\n                      h(\r\n                        'div',\r\n                        {\r\n                          class: [`${prefixCls}-footer`],\r\n                        },\r\n                        h(\r\n                          Space,\r\n                          {},\r\n                          {\r\n                            default: () => {\r\n                              const FooterProtalTarget = h(\r\n                                'span',\r\n                                {\r\n                                  id: PORTAL_TARGET_NAME,\r\n                                },\r\n                                {}\r\n                              )\r\n                              if (footer === null) {\r\n                                return [null, FooterProtalTarget]\r\n                              } else if (footer) {\r\n                                return [\r\n                                  resolveComponent(footer),\r\n                                  FooterProtalTarget,\r\n                                ]\r\n                              }\r\n                              return [\r\n                                h(\r\n                                  Button,\r\n                                  {\r\n                                    ...cancelButtonProps,\r\n                                    onClick: (e) => {\r\n                                      onClose?.(e)\r\n                                      reject()\r\n                                    },\r\n                                  },\r\n                                  {\r\n                                    default: () => resolveComponent(cancelText),\r\n                                  }\r\n                                ),\r\n                                h(\r\n                                  Button,\r\n                                  {\r\n                                    ...okButtonProps,\r\n                                    type: okType,\r\n                                    loading: env.form.submitting,\r\n                                    onClick: (e) => {\r\n                                      onOk?.(e)\r\n                                      resolve()\r\n                                    },\r\n                                  },\r\n                                  {\r\n                                    default: () => resolveComponent(okText),\r\n                                  }\r\n                                ),\r\n                                FooterProtalTarget,\r\n                              ]\r\n                            },\r\n                          }\r\n                        )\r\n                      ),\r\n                    ],\r\n                  }\r\n                ),\r\n              title: () =>\r\n                h(\r\n                  FragmentComponent,\r\n                  {},\r\n                  { default: () => resolveComponent(title) }\r\n                ),\r\n            }\r\n          )\r\n        },\r\n      })\r\n      env.app = createApp(ComponentConstructor, {\r\n        drawerProps,\r\n        parent: getProtalContext(id as string | symbol),\r\n      })\r\n      env.instance = env.app.mount(env.root)\r\n    }\r\n    env.instance.visible = visible\r\n  }\r\n\r\n  const formDrawer = {\r\n    forOpen: (middleware: IMiddleware<IFormProps>) => {\r\n      if (isFn(middleware)) {\r\n        env.openMiddlewares.push(middleware)\r\n      }\r\n      return formDrawer\r\n    },\r\n    forConfirm: (middleware: IMiddleware<Form>) => {\r\n      if (isFn(middleware)) {\r\n        env.confirmMiddlewares.push(middleware)\r\n      }\r\n      return formDrawer\r\n    },\r\n    forCancel: (middleware: IMiddleware<Form>) => {\r\n      if (isFn(middleware)) {\r\n        env.cancelMiddlewares.push(middleware)\r\n      }\r\n      return formDrawer\r\n    },\r\n    open: async (props: IFormProps) => {\r\n      if (env.promise) return env.promise\r\n      env.promise = new Promise(async (resolve, reject) => {\r\n        try {\r\n          props = await loading(drawerProps.loadingText, () =>\r\n            applyMiddleware(props, env.openMiddlewares)\r\n          )\r\n          env.form = env.form || createForm(props)\r\n        } catch (e) {\r\n          reject(e)\r\n        }\r\n\r\n        renderDrawer(\r\n          true,\r\n          () => {\r\n            env.form\r\n              .submit(async () => {\r\n                await applyMiddleware(env.form, env.confirmMiddlewares)\r\n                resolve(toJS(env.form.values))\r\n                formDrawer.close()\r\n              })\r\n              .catch(reject)\r\n          },\r\n          async () => {\r\n            formDrawer.close()\r\n          }\r\n        )\r\n      })\r\n      return env.promise\r\n    },\r\n    close: () => {\r\n      if (!env.root) return\r\n      renderDrawer(false)\r\n    },\r\n  }\r\n  return formDrawer\r\n}\r\n\r\nconst DrawerFooter = defineComponent({\r\n  name: 'DrawerFooter',\r\n  setup(props, { slots }) {\r\n    return () => {\r\n      if (document.querySelector(`#${PORTAL_TARGET_NAME}`)) {\r\n        return h(\r\n          Teleport as any,\r\n          {\r\n            to: `#${PORTAL_TARGET_NAME}`,\r\n          },\r\n          slots\r\n        )\r\n      } else {\r\n        return null\r\n      }\r\n    }\r\n  },\r\n})\r\n\r\nFormDrawer.Footer = DrawerFooter\r\nFormDrawer.Portal = createPortalProvider('form-drawer')\r\n\r\nexport default FormDrawer\r\n"]}