{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["array-base/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Button } from 'ant-design-vue'\r\nimport { stylePrefix } from '../__builtins__/configs'\r\nimport { FragmentComponent, useField, useFieldSchema } from '@formily/vue'\r\nimport { isValid, clone, uid } from '@formily/shared'\r\nimport type { ArrayField } from '@formily/core'\r\nimport type { ButtonProps } from 'ant-design-vue/lib/button'\r\nimport type { Schema } from '@formily/json-schema'\r\nimport type { Ref, InjectionKey } from 'vue'\r\nimport {\r\n  MenuOutlined,\r\n  PlusOutlined,\r\n  DeleteOutlined,\r\n  DownOutlined,\r\n  UpOutlined,\r\n} from '@ant-design/icons-vue'\r\nimport {\r\n  defineComponent,\r\n  provide,\r\n  inject,\r\n  toRefs,\r\n  ref,\r\n  onBeforeUnmount,\r\n  withDirectives,\r\n  h,\r\n} from 'vue'\r\nimport { HandleDirective } from 'vue-slicksort'\r\nimport { composeExport } from '../__builtins__/shared'\r\n\r\nexport type KeyMapProps =\r\n  | WeakMap<Record<string, unknown>, string>\r\n  | string[]\r\n  | null\r\n\r\nexport interface IArrayBaseAdditionProps extends ButtonProps {\r\n  title?: string\r\n  method?: 'push' | 'unshift'\r\n  defaultValue?: any\r\n}\r\n\r\nexport interface IArrayBaseItemProps {\r\n  index: number\r\n  record: any\r\n}\r\n\r\nexport type ArrayBaseRemoveProps = ButtonProps & {\r\n  title?: string\r\n  index?: number\r\n}\r\n\r\nexport type ArrayBaseMixins = {\r\n  Addition?: typeof ArrayBaseAddition\r\n  Remove?: typeof ArrayBaseRemove\r\n  MoveUp?: typeof ArrayBaseMoveUp\r\n  MoveDown?: typeof ArrayBaseMoveDown\r\n  SortHandle?: typeof ArrayBaseSortHandle\r\n  Index?: typeof ArrayBaseIndex\r\n  useArray?: typeof useArray\r\n  useIndex?: typeof useIndex\r\n  useRecord?: typeof useRecord\r\n}\r\n\r\nexport interface IArrayBaseProps {\r\n  disabled?: boolean\r\n  onAdd?: (index: number) => void\r\n  onRemove?: (index: number) => void\r\n  onMoveDown?: (index: number) => void\r\n  onMoveUp?: (index: number) => void\r\n  keyMap?: KeyMapProps\r\n}\r\n\r\nexport interface IArrayBaseContext {\r\n  props: IArrayBaseProps\r\n  field: Ref<ArrayField>\r\n  schema: Ref<Schema>\r\n  attrs: {\r\n    [key in string]?: any\r\n  }\r\n  keyMap?: KeyMapProps\r\n}\r\n\r\nconst ArrayBaseSymbol: InjectionKey<IArrayBaseContext> =\r\n  Symbol('ArrayBaseContext')\r\nconst ItemSymbol: InjectionKey<IArrayBaseItemProps> = Symbol('ItemContext')\r\n\r\nconst useArray = () => {\r\n  return inject(ArrayBaseSymbol, null)\r\n}\r\n\r\nconst useIndex = (index?: number) => {\r\n  const { index: indexRef } = toRefs(inject(ItemSymbol))\r\n  return indexRef ?? ref(index)\r\n}\r\n\r\nconst useRecord = (record?: number) => {\r\n  const { record: recordRef } = toRefs(inject(ItemSymbol))\r\n  return recordRef ?? ref(record)\r\n}\r\n\r\nconst isObjectValue = (schema: Schema) => {\r\n  if (Array.isArray(schema?.items)) return isObjectValue(schema.items[0])\r\n\r\n  if (schema?.items?.type === 'array' || schema?.items?.type === 'object') {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nconst useKey = (schema: Schema) => {\r\n  const isObject = isObjectValue(schema)\r\n  let keyMap: KeyMapProps = null\r\n\r\n  if (isObject) {\r\n    keyMap = new WeakMap()\r\n  } else {\r\n    keyMap = []\r\n  }\r\n\r\n  onBeforeUnmount(() => {\r\n    keyMap = null\r\n  })\r\n\r\n  return {\r\n    keyMap,\r\n    getKey: (record: any, index?: number) => {\r\n      if (keyMap instanceof WeakMap) {\r\n        if (!keyMap.has(record)) {\r\n          keyMap.set(record, uid())\r\n        }\r\n        return `${keyMap.get(record)}-${index}`\r\n      }\r\n\r\n      if (!keyMap[index]) {\r\n        keyMap[index] = uid()\r\n      }\r\n\r\n      return `${keyMap[index]}-${index}`\r\n    },\r\n  }\r\n}\r\n\r\nconst getDefaultValue = (defaultValue: any, schema: Schema) => {\r\n  if (isValid(defaultValue)) return clone(defaultValue)\r\n  if (Array.isArray(schema?.items))\r\n    return getDefaultValue(defaultValue, schema.items[0])\r\n  if (schema?.items?.type === 'array') return []\r\n  if (schema?.items?.type === 'boolean') return true\r\n  if (schema?.items?.type === 'date') return ''\r\n  if (schema?.items?.type === 'datetime') return ''\r\n  if (schema?.items?.type === 'number') return 0\r\n  if (schema?.items?.type === 'object') return {}\r\n  if (schema?.items?.type === 'string') return ''\r\n  return null\r\n}\r\n\r\nconst ArrayBaseInner = defineComponent({\r\n  name: 'ArrayBase',\r\n  inheritAttrs: false,\r\n  props: ['disabled', 'keyMap'],\r\n  setup(props: IArrayBaseProps, { slots, attrs }) {\r\n    const field = useField<ArrayField>()\r\n    const schema = useFieldSchema()\r\n    provide(ArrayBaseSymbol, {\r\n      field,\r\n      schema,\r\n      props,\r\n      attrs,\r\n      keyMap: props.keyMap,\r\n    })\r\n    return () => {\r\n      return h(FragmentComponent, {}, slots)\r\n    }\r\n  },\r\n})\r\n\r\nconst ArrayBaseItem = defineComponent({\r\n  name: 'ArrayBaseItem',\r\n  inheritAttrs: false,\r\n  props: ['index', 'record'],\r\n  setup(props: IArrayBaseItemProps, { slots }) {\r\n    provide(ItemSymbol, props)\r\n    return () => {\r\n      return h(FragmentComponent, {}, slots)\r\n    }\r\n  },\r\n})\r\n\r\nconst ArrayBaseSortHandle = defineComponent({\r\n  name: 'ArrayBaseSortHandle',\r\n  props: ['index'],\r\n  setup(props, { attrs }) {\r\n    const array = useArray()\r\n    const prefixCls = `${stylePrefix}-array-base`\r\n\r\n    return () => {\r\n      if (!array) return null\r\n      if (array.field.value?.pattern !== 'editable') return null\r\n\r\n      return withDirectives(\r\n        h(MenuOutlined, {\r\n          ...attrs,\r\n          class: [`${prefixCls}-sort-handle`],\r\n        }),\r\n        [[HandleDirective]]\r\n      )\r\n    }\r\n  },\r\n})\r\n\r\nconst ArrayBaseIndex = defineComponent({\r\n  name: 'ArrayBaseIndex',\r\n  setup(props, { attrs }) {\r\n    const index = useIndex()\r\n    const prefixCls = `${stylePrefix}-array-base`\r\n    return () => {\r\n      return h(\r\n        'span',\r\n        {\r\n          attrs,\r\n          class: `${prefixCls}-index`,\r\n        },\r\n        {\r\n          default: () => [`#${index.value + 1}.`],\r\n        }\r\n      )\r\n    }\r\n  },\r\n})\r\n\r\nconst ArrayBaseAddition = defineComponent({\r\n  name: 'ArrayBaseAddition',\r\n  props: ['title', 'method', 'defaultValue'],\r\n  setup(props: IArrayBaseAdditionProps, { attrs }) {\r\n    const self = useField()\r\n    const array = useArray()\r\n    const prefixCls = `${stylePrefix}-array-base`\r\n    return () => {\r\n      if (!array) return null\r\n      if (\r\n        array?.field.value.pattern !== 'editable' &&\r\n        array?.field.value.pattern !== 'disabled'\r\n      )\r\n        return null\r\n      return h(\r\n        Button,\r\n        {\r\n          ...attrs,\r\n          ...props,\r\n          class: `${prefixCls}-addition`,\r\n          type: 'dashed',\r\n          block: true,\r\n          disabled: array.field.value?.disabled,\r\n          onClick: (e) => {\r\n            if (array.props?.disabled) return\r\n            const defaultValue = getDefaultValue(\r\n              props.defaultValue,\r\n              array?.schema.value\r\n            )\r\n            if (props.method === 'unshift') {\r\n              array?.field?.value.unshift(defaultValue)\r\n              array.attrs?.add?.(0)\r\n            } else {\r\n              array?.field?.value.push(defaultValue)\r\n              array.attrs?.add?.(array?.field?.value?.value?.length - 1)\r\n            }\r\n            if (typeof attrs.onClick === 'function') {\r\n              attrs.onClick(e)\r\n            }\r\n          },\r\n        },\r\n        {\r\n          default: () => [h(PlusOutlined), self.value.title || props.title],\r\n        }\r\n      )\r\n    }\r\n  },\r\n})\r\n\r\nconst ArrayBaseRemove = defineComponent({\r\n  name: 'ArrayBaseRemove',\r\n  // props: ['title', 'index'],\r\n  props: {\r\n    title: String,\r\n    index: Number,\r\n  },\r\n  setup(props, { attrs }) {\r\n    const indexRef = useIndex(props.index)\r\n    const base = useArray()\r\n    const prefixCls = `${stylePrefix}-array-base`\r\n    return () => {\r\n      if (base?.field.value.pattern !== 'editable') return null\r\n      return h(DeleteOutlined, {\r\n        class: `${prefixCls}-remove`,\r\n        attrs,\r\n        onClick: (e: MouseEvent) => {\r\n          e.stopPropagation()\r\n          if (Array.isArray(base?.keyMap)) {\r\n            base?.keyMap?.splice(indexRef.value, 1)\r\n          }\r\n\r\n          base?.field.value.remove(indexRef.value as number)\r\n          base?.attrs?.remove?.(indexRef.value as number)\r\n\r\n          if (typeof attrs.onClick === 'function') {\r\n            attrs.onClick(e)\r\n          }\r\n        },\r\n      })\r\n    }\r\n  },\r\n})\r\n\r\nconst ArrayBaseMoveDown = defineComponent({\r\n  name: 'ArrayBaseMoveDown',\r\n  props: ['title', 'index'],\r\n  setup(props, { attrs }) {\r\n    const indexRef = useIndex(props.index)\r\n    const base = useArray()\r\n    const prefixCls = `${stylePrefix}-array-base`\r\n    return () => {\r\n      if (base?.field.value.pattern !== 'editable') return null\r\n      return h(DownOutlined, {\r\n        class: `${prefixCls}-move-down`,\r\n        attrs,\r\n        onClick: (e: MouseEvent) => {\r\n          e.stopPropagation()\r\n          if (Array.isArray(base?.keyMap)) {\r\n            base.keyMap.splice(\r\n              indexRef.value + 1,\r\n              0,\r\n              base.keyMap.splice(indexRef.value, 1)[0]\r\n            )\r\n          }\r\n\r\n          base?.field.value.moveDown(indexRef.value as number)\r\n          base?.attrs?.moveDown?.(indexRef.value as number)\r\n\r\n          if (typeof attrs.onClick === 'function') {\r\n            attrs.onClick(e)\r\n          }\r\n        },\r\n      })\r\n    }\r\n  },\r\n})\r\n\r\nconst ArrayBaseMoveUp = defineComponent({\r\n  name: 'ArrayBaseMoveUp',\r\n  props: ['title', 'index'],\r\n  setup(props, { attrs }) {\r\n    const indexRef = useIndex(props.index)\r\n    const base = useArray()\r\n    const prefixCls = `${stylePrefix}-array-base`\r\n    return () => {\r\n      if (base?.field.value.pattern !== 'editable') return null\r\n      return h(UpOutlined, {\r\n        class: `${prefixCls}-move-up`,\r\n        attrs,\r\n        onClick: (e: MouseEvent) => {\r\n          e.stopPropagation()\r\n          if (Array.isArray(base?.keyMap)) {\r\n            base.keyMap.splice(\r\n              indexRef.value - 1,\r\n              0,\r\n              base.keyMap.splice(indexRef.value, 1)[0]\r\n            )\r\n          }\r\n\r\n          base?.field.value.moveUp(indexRef.value as number)\r\n          base?.attrs?.moveUp?.(indexRef.value as number)\r\n\r\n          if (typeof attrs.onClick === 'function') {\r\n            attrs.onClick(e)\r\n          }\r\n        },\r\n      })\r\n    }\r\n  },\r\n})\r\n\r\nexport const ArrayBase = composeExport(ArrayBaseInner, {\r\n  Index: ArrayBaseIndex,\r\n  Item: ArrayBaseItem,\r\n  SortHandle: ArrayBaseSortHandle,\r\n  Addition: ArrayBaseAddition,\r\n  Remove: ArrayBaseRemove,\r\n  MoveDown: ArrayBaseMoveDown,\r\n  MoveUp: ArrayBaseMoveUp,\r\n  useArray: useArray,\r\n  useIndex: useIndex,\r\n  useKey: useKey,\r\n  useRecord: useRecord,\r\n})\r\n\r\nexport default ArrayBase\r\n"]}