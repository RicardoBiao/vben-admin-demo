{"version":3,"file":"index.js","sourceRoot":"lib/","sources":["form-dialog/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,gBAAgB,CAAA;AAE9C,OAAO,EAAE,YAAY,EAAE,iBAAiB,EAAE,MAAM,cAAc,CAAA;AAC9D,OAAO,EAAE,QAAQ,EAAE,MAAM,uBAAuB,CAAA;AAEhD,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,eAAe,EAAE,MAAM,iBAAiB,CAAA;AAC7E,OAAO,EAAE,IAAI,EAAE,MAAM,mBAAmB,CAAA;AAExC,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAA;AAE1C,OAAO,EAAE,CAAC,EAAE,eAAe,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAA;AAC7D,OAAO,EAAE,WAAW,EAAE,MAAM,yBAAyB,CAAA;AAErD,OAAO,EACL,cAAc,EACd,gBAAgB,EAChB,oBAAoB,EACpB,gBAAgB,EAChB,OAAO,GACR,MAAM,wBAAwB,CAAA;AAE/B,IAAM,kBAAkB,GAAG,kBAAkB,CAAA;AAM7C,IAAM,YAAY,GAAG,UAAC,KAAU;IAC9B,OAAO,KAAK,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,cAAc,CAAC,KAAK,CAAC,CAAA;AAC/E,CAAC,CAAA;AAED,IAAM,aAAa,GAAG,UAAC,KAAU;IAC/B,IAAI,YAAY,CAAC,KAAK,CAAC,EAAE;QACvB,OAAO;YACL,KAAK,EAAE,KAAK;SACE,CAAA;KACjB;SAAM;QACL,OAAO,KAAK,CAAA;KACb;AACH,CAAC,CAAA;AAmCD,MAAM,UAAU,UAAU,CACxB,KAA+B,EAC/B,EAAwC,EACxC,QAA6B;IAH/B,iBAkPC;IA7OC,IAAI,IAAI,CAAC,EAAE,CAAC,IAAI,cAAc,CAAC,EAAE,CAAC,EAAE;QAClC,QAAQ,GAAG,EAAwB,CAAA;QACnC,EAAE,GAAG,aAAa,CAAA;KACnB;IAED,IAAM,SAAS,GAAG,UAAG,WAAW,iBAAc,CAAA;IAC9C,IAAM,GAAG,GAAG;QACV,IAAI,EAAE,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;QACnC,IAAI,EAAE,IAAI;QACV,OAAO,EAAE,IAAI;QACb,GAAG,EAAE,IAAI;QACT,QAAQ,EAAE,IAAI;QACd,eAAe,EAAE,EAAE;QACnB,kBAAkB,EAAE,EAAE;QACtB,iBAAiB,EAAE,EAAE;KACtB,CAAA;IAED,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;IACnC,IAAM,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,CAAA;IAElC,IAAM,WAAW,yBACZ,KAAK,KACR,UAAU,EAAE;;YACV,MAAA,KAAK,CAAC,UAAU,qDAAI,CAAA;YACpB,MAAA,GAAG,CAAC,GAAG,0CAAE,OAAO,EAAE,CAAA;YAClB,GAAG,CAAC,QAAQ,GAAG,IAAI,CAAA;YACnB,GAAG,CAAC,GAAG,GAAG,IAAI,CAAA;YACd,MAAA,MAAA,GAAG,CAAC,IAAI,0CAAE,UAAU,0CAAE,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;YAC3C,GAAG,CAAC,IAAI,GAAG,SAAS,CAAA;QACtB,CAAC,GACF,CAAA;IAED,IAAM,aAAa,GAAG,QAAQ;IAC5B,sDAAsD;IACtD,eAAe,CAAC;QACd,KAAK;YACH,OAAO;gBACL,OAAA,CAAC,CACC,iBAAiB,EACjB,EAAE,EACF;oBACE,OAAO,EAAE,cAAM,OAAA,gBAAgB,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,CAAC,EAA9C,CAA8C;iBAC9D,CACF;YAND,CAMC,CAAA;QACL,CAAC;KACF,CAAC,CACH,CAAA;IAED,IAAM,YAAY,GAAG,UACnB,OAAc,EACd,OAAmB,EACnB,MAAkB;QAFlB,wBAAA,EAAA,cAAc;QAId,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,sDAAsD;YACtD,IAAM,oBAAoB,GAAG,eAAe,CAAC;gBAC3C,KAAK,EAAE,CAAC,aAAa,CAAC;gBACtB,IAAI;oBACF,OAAO;wBACL,OAAO,EAAE,KAAK;qBACf,CAAA;gBACH,CAAC;gBACD,MAAM;oBAAN,iBAwGC;oBAvGC,IAAM,KAWF,IAAI,CAAC,WAAW,EAVlB,IAAI,UAAA,EACJ,QAAQ,cAAA,EACR,KAAK,WAAA,EACL,MAAM,YAAA,EACN,cAAa,EAAb,MAAM,mBAAG,IAAI,KAAA,EACb,cAAkB,EAAlB,MAAM,mBAAG,SAAS,KAAA,EAClB,aAAa,mBAAA,EACb,iBAAiB,uBAAA,EACjB,kBAAiB,EAAjB,UAAU,mBAAG,IAAI,KAAA,EACd,WAAW,cAVV,+GAWL,CAAmB,CAAA;oBACpB,OAAO,CAAC,CACN,KAAK,sBAEH,KAAK,EAAE,SAAS,IACb,WAAW,KACd,OAAO,EAAE,IAAI,CAAC,OAAO,EACrB,kBAAkB,EAAE,UAAC,GAAG;4BACtB,KAAI,CAAC,OAAO,GAAG,GAAG,CAAA;wBACpB,CAAC,EACD,QAAQ,EAAE,UAAC,CAAC;4BACV,IAAI,CAAA,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,CAAC,CAAC,MAAK,KAAK,EAAE;gCAC3B,MAAM,aAAN,MAAM,uBAAN,MAAM,EAAI,CAAA;6BACX;wBACH,CAAC,EACD,IAAI,EAAE,UAAC,CAAC;4BACN,IAAI,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAG,CAAC,CAAC,MAAK,KAAK,EAAE;gCACvB,OAAO,aAAP,OAAO,uBAAP,OAAO,EAAI,CAAA;6BACZ;wBACH,CAAC,KAEH;wBACE,OAAO,EAAE;4BACP,OAAA,CAAC,CACC,YAAY,EACZ;gCACE,IAAI,EAAE,GAAG,CAAC,IAAI;6BACf,EACD;gCACE,OAAO,EAAE,cAAM,OAAA,CAAC,CAAC,CAAC,aAAa,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,EAA1B,CAA0B;6BAC1C,CACF;wBARD,CAQC;wBACH,KAAK,EAAE;4BACL,OAAA,CAAC,CACC,iBAAiB,EACjB,EAAE,EACF,EAAE,OAAO,EAAE,cAAM,OAAA,gBAAgB,CAAC,KAAK,CAAC,EAAvB,CAAuB,EAAE,CAC3C;wBAJD,CAIC;wBACH,MAAM,EAAE;4BACN,OAAA,CAAC,CACC,iBAAiB,EACjB,EAAE,EACF;gCACE,OAAO,EAAE;oCACP,IAAM,kBAAkB,GAAG,CAAC,CAC1B,MAAM,EACN;wCACE,EAAE,EAAE,kBAAkB;qCACvB,EACD,EAAE,CACH,CAAA;oCACD,IAAI,MAAM,KAAK,IAAI,EAAE;wCACnB,OAAO,CAAC,IAAI,EAAE,kBAAkB,CAAC,CAAA;qCAClC;yCAAM,IAAI,MAAM,EAAE;wCACjB,OAAO,CAAC,gBAAgB,CAAC,MAAM,CAAC,EAAE,kBAAkB,CAAC,CAAA;qCACtD;oCACD,OAAO;wCACL,CAAC,CACC,MAAM,wBAED,iBAAiB,KACpB,OAAO,EAAE,UAAC,CAAC;gDACT,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAG,CAAC,CAAC,CAAA;gDACb,MAAM,EAAE,CAAA;4CACV,CAAC,KAEH;4CACE,OAAO,EAAE,cAAM,OAAA,gBAAgB,CAAC,UAAU,CAAC,EAA5B,CAA4B;yCAC5C,CACF;wCACD,CAAC,CACC,MAAM,wBAED,aAAa,KAChB,IAAI,EAAE,MAAM,EACZ,OAAO,EAAE,GAAG,CAAC,IAAI,CAAC,UAAU,EAC5B,OAAO,EAAE,UAAC,CAAC;gDACT,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAG,CAAC,CAAC,CAAA;gDACT,OAAO,EAAE,CAAA;4CACX,CAAC,KAEH;4CACE,OAAO,EAAE,cAAM,OAAA,gBAAgB,CAAC,MAAM,CAAC,EAAxB,CAAwB;yCACxC,CACF;wCACD,kBAAkB;qCACnB,CAAA;gCACH,CAAC;6BACF,CACF;wBAlDD,CAkDC;qBACJ,CACF,CAAA;gBACH,CAAC;aACF,CAAC,CAAA;YAEF,GAAG,CAAC,GAAG,GAAG,SAAS,CAAC,oBAAoB,EAAE;gBACxC,WAAW,aAAA;gBACX,MAAM,EAAE,gBAAgB,CAAC,EAAqB,CAAC;aAChD,CAAC,CAAA;YAEF,GAAG,CAAC,QAAQ,GAAG,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;SACvC;QACD,GAAG,CAAC,QAAQ,CAAC,OAAO,GAAG,OAAO,CAAA;IAChC,CAAC,CAAA;IAED,IAAM,UAAU,GAAG;QACjB,OAAO,EAAE,UAAC,UAAmC;YAC3C,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE;gBACpB,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;aACrC;YACD,OAAO,UAAU,CAAA;QACnB,CAAC;QACD,UAAU,EAAE,UAAC,UAA6B;YACxC,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE;gBACpB,GAAG,CAAC,kBAAkB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;aACxC;YACD,OAAO,UAAU,CAAA;QACnB,CAAC;QACD,SAAS,EAAE,UAAC,UAA6B;YACvC,IAAI,IAAI,CAAC,UAAU,CAAC,EAAE;gBACpB,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;aACvC;YACD,OAAO,UAAU,CAAA;QACnB,CAAC;QACD,IAAI,EAAE,UAAO,KAAiB;;;gBAC5B,IAAI,GAAG,CAAC,OAAO;oBAAE,sBAAO,GAAG,CAAC,OAAO,EAAA;gBACnC,GAAG,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,UAAO,OAAO,EAAE,MAAM;;;;;;;gCAEpC,qBAAM,OAAO,CAAC,WAAW,CAAC,WAAW,EAAE;wCAC7C,OAAA,eAAe,CAAC,KAAK,EAAE,GAAG,CAAC,eAAe,CAAC;oCAA3C,CAA2C,CAC5C,EAAA;;gCAFD,KAAK,GAAG,SAEP,CAAA;gCACD,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,IAAI,UAAU,CAAC,KAAK,CAAC,CAAA;;;;gCAExC,MAAM,CAAC,GAAC,CAAC,CAAA;;;gCAGX,YAAY,CACV,IAAI,EACJ;oCACE,GAAG,CAAC,IAAI;yCACL,MAAM,CAAC;;;wDACN,qBAAM,eAAe,CAAC,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,kBAAkB,CAAC,EAAA;;oDAAvD,SAAuD,CAAA;oDACvD,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAA;oDAC9B,UAAU,CAAC,KAAK,EAAE,CAAA;;;;yCACnB,CAAC;yCACD,KAAK,CAAC,MAAM,CAAC,CAAA;gCAClB,CAAC,EACD;;;oDACE,qBAAM,OAAO,CAAC,WAAW,CAAC,WAAW,EAAE;oDACrC,OAAA,eAAe,CAAC,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,iBAAiB,CAAC;gDAAhD,CAAgD,CACjD,EAAA;;gDAFD,SAEC,CAAA;gDACD,UAAU,CAAC,KAAK,EAAE,CAAA;;;;qCACnB,CACF,CAAA;;;;qBACF,CAAC,CAAA;gBACF,sBAAO,GAAG,CAAC,OAAO,EAAA;;aACnB;QACD,KAAK,EAAE;YACL,IAAI,CAAC,GAAG,CAAC,IAAI;gBAAE,OAAM;YACrB,YAAY,CAAC,KAAK,CAAC,CAAA;QACrB,CAAC;KACF,CAAA;IACD,OAAO,UAAU,CAAA;AACnB,CAAC;AAED,sDAAsD;AACtD,IAAM,YAAY,GAAG,eAAe,CAAC;IACnC,IAAI,EAAE,cAAc;IACpB,KAAK,EAAL,UAAM,KAAK,EAAE,EAAS;YAAP,KAAK,WAAA;QAClB,OAAO;YACL,IAAI,QAAQ,CAAC,aAAa,CAAC,WAAI,kBAAkB,CAAE,CAAC,EAAE;gBACpD,OAAO,CAAC,CACN,QAAe,EACf;oBACE,EAAE,EAAE,WAAI,kBAAkB,CAAE;iBAC7B,EACD,KAAK,CACN,CAAA;aACF;iBAAM;gBACL,OAAO,IAAI,CAAA;aACZ;QACH,CAAC,CAAA;IACH,CAAC;CACF,CAAC,CAAA;AAEF,UAAU,CAAC,MAAM,GAAG,YAAY,CAAA;AAChC,UAAU,CAAC,MAAM,GAAG,oBAAoB,CAAC,aAAa,CAAC,CAAA;AAEvD,eAAe,UAAU,CAAA","sourcesContent":["import { Button, Modal } from 'ant-design-vue'\r\nimport type { ModalProps } from 'ant-design-vue/lib/modal'\r\nimport { FormProvider, FragmentComponent } from '@formily/vue'\r\nimport { observer } from '@formily/reactive-vue'\r\nimport type { IMiddleware } from '@formily/shared'\r\nimport { isNum, isStr, isBool, isFn, applyMiddleware } from '@formily/shared'\r\nimport { toJS } from '@formily/reactive'\r\nimport type { Form, IFormProps } from '@formily/core'\r\nimport { createForm } from '@formily/core'\r\nimport type { VNode, Component } from 'vue'\r\nimport { h, defineComponent, createApp, Teleport } from 'vue'\r\nimport { stylePrefix } from '../__builtins__/configs'\r\n\r\nimport {\r\n  isValidElement,\r\n  resolveComponent,\r\n  createPortalProvider,\r\n  getProtalContext,\r\n  loading,\r\n} from '../__builtins__/shared'\r\n\r\nconst PORTAL_TARGET_NAME = 'FormDialogFooter'\r\n\r\ntype FormDialogRenderer = VNode | ((form: Form) => VNode)\r\n\r\ntype ModalTitle = string | number | Component | VNode | (() => VNode)\r\n\r\nconst isModalTitle = (props: any): props is ModalTitle => {\r\n  return isNum(props) || isStr(props) || isBool(props) || isValidElement(props)\r\n}\r\n\r\nconst getModelProps = (props: any): IModalProps => {\r\n  if (isModalTitle(props)) {\r\n    return {\r\n      title: props,\r\n    } as IModalProps\r\n  } else {\r\n    return props\r\n  }\r\n}\r\n\r\nexport interface IFormDialog {\r\n  forOpen(middleware: IMiddleware<IFormProps>): IFormDialog\r\n  forConfirm(middleware: IMiddleware<Form>): IFormDialog\r\n  forCancel(middleware: IMiddleware<Form>): IFormDialog\r\n  open(props?: IFormProps): Promise<any>\r\n  close(): void\r\n}\r\n\r\nexport interface IModalProps extends ModalProps {\r\n  onOk?: (event?: MouseEvent) => void | boolean\r\n  onCancel?: (event?: MouseEvent) => void | boolean\r\n  loadingText?: string\r\n}\r\n\r\nexport function FormDialog(\r\n  title: IModalProps,\r\n  id: string,\r\n  renderer: FormDialogRenderer\r\n): IFormDialog\r\nexport function FormDialog(\r\n  title: IModalProps,\r\n  renderer: FormDialogRenderer\r\n): IFormDialog\r\nexport function FormDialog(\r\n  title: ModalTitle,\r\n  id: string,\r\n  renderer: FormDialogRenderer\r\n): IFormDialog\r\nexport function FormDialog(\r\n  title: ModalTitle,\r\n  renderer: FormDialogRenderer\r\n): IFormDialog\r\n\r\nexport function FormDialog(\r\n  title: ModalTitle | IModalProps,\r\n  id: string | symbol | FormDialogRenderer,\r\n  renderer?: FormDialogRenderer\r\n): IFormDialog {\r\n  if (isFn(id) || isValidElement(id)) {\r\n    renderer = id as FormDialogRenderer\r\n    id = 'form-dialog'\r\n  }\r\n\r\n  const prefixCls = `${stylePrefix}-form-dialog`\r\n  const env = {\r\n    root: document.createElement('div'),\r\n    form: null,\r\n    promise: null,\r\n    app: null,\r\n    instance: null,\r\n    openMiddlewares: [],\r\n    confirmMiddlewares: [],\r\n    cancelMiddlewares: [],\r\n  }\r\n\r\n  document.body.appendChild(env.root)\r\n  const props = getModelProps(title)\r\n\r\n  const dialogProps = {\r\n    ...props,\r\n    afterClose: () => {\r\n      props.afterClose?.()\r\n      env.app?.unmount()\r\n      env.instance = null\r\n      env.app = null\r\n      env.root?.parentNode?.removeChild(env.root)\r\n      env.root = undefined\r\n    },\r\n  }\r\n\r\n  const DialogContent = observer(\r\n    // eslint-disable-next-line vue/one-component-per-file\r\n    defineComponent({\r\n      setup() {\r\n        return () =>\r\n          h(\r\n            FragmentComponent,\r\n            {},\r\n            {\r\n              default: () => resolveComponent(renderer, { form: env.form }),\r\n            }\r\n          )\r\n      },\r\n    })\r\n  )\r\n\r\n  const renderDialog = (\r\n    visible = true,\r\n    resolve?: () => any,\r\n    reject?: () => any\r\n  ) => {\r\n    if (!env.instance) {\r\n      // eslint-disable-next-line vue/one-component-per-file\r\n      const ComponentConstructor = defineComponent({\r\n        props: ['dialogProps'],\r\n        data() {\r\n          return {\r\n            visible: false,\r\n          }\r\n        },\r\n        render() {\r\n          const {\r\n            onOk,\r\n            onCancel,\r\n            title,\r\n            footer,\r\n            okText = '确定',\r\n            okType = 'primary',\r\n            okButtonProps,\r\n            cancelButtonProps,\r\n            cancelText = '取消',\r\n            ...dialogProps\r\n          } = this.dialogProps\r\n          return h(\r\n            Modal,\r\n            {\r\n              class: prefixCls,\r\n              ...dialogProps,\r\n              visible: this.visible,\r\n              'onUpdate:visible': (val) => {\r\n                this.visible = val\r\n              },\r\n              onCancel: (e) => {\r\n                if (onCancel?.(e) !== false) {\r\n                  reject?.()\r\n                }\r\n              },\r\n              onOk: (e) => {\r\n                if (onOk?.(e) !== false) {\r\n                  resolve?.()\r\n                }\r\n              },\r\n            },\r\n            {\r\n              default: () =>\r\n                h(\r\n                  FormProvider,\r\n                  {\r\n                    form: env.form,\r\n                  },\r\n                  {\r\n                    default: () => [h(DialogContent, {}, {})],\r\n                  }\r\n                ),\r\n              title: () =>\r\n                h(\r\n                  FragmentComponent,\r\n                  {},\r\n                  { default: () => resolveComponent(title) }\r\n                ),\r\n              footer: () =>\r\n                h(\r\n                  FragmentComponent,\r\n                  {},\r\n                  {\r\n                    default: () => {\r\n                      const FooterProtalTarget = h(\r\n                        'span',\r\n                        {\r\n                          id: PORTAL_TARGET_NAME,\r\n                        },\r\n                        {}\r\n                      )\r\n                      if (footer === null) {\r\n                        return [null, FooterProtalTarget]\r\n                      } else if (footer) {\r\n                        return [resolveComponent(footer), FooterProtalTarget]\r\n                      }\r\n                      return [\r\n                        h(\r\n                          Button,\r\n                          {\r\n                            ...cancelButtonProps,\r\n                            onClick: (e) => {\r\n                              onCancel?.(e)\r\n                              reject()\r\n                            },\r\n                          },\r\n                          {\r\n                            default: () => resolveComponent(cancelText),\r\n                          }\r\n                        ),\r\n                        h(\r\n                          Button,\r\n                          {\r\n                            ...okButtonProps,\r\n                            type: okType,\r\n                            loading: env.form.submitting,\r\n                            onClick: (e) => {\r\n                              onOk?.(e)\r\n                              resolve()\r\n                            },\r\n                          },\r\n                          {\r\n                            default: () => resolveComponent(okText),\r\n                          }\r\n                        ),\r\n                        FooterProtalTarget,\r\n                      ]\r\n                    },\r\n                  }\r\n                ),\r\n            }\r\n          )\r\n        },\r\n      })\r\n\r\n      env.app = createApp(ComponentConstructor, {\r\n        dialogProps,\r\n        parent: getProtalContext(id as string | symbol),\r\n      })\r\n\r\n      env.instance = env.app.mount(env.root)\r\n    }\r\n    env.instance.visible = visible\r\n  }\r\n\r\n  const formDialog = {\r\n    forOpen: (middleware: IMiddleware<IFormProps>) => {\r\n      if (isFn(middleware)) {\r\n        env.openMiddlewares.push(middleware)\r\n      }\r\n      return formDialog\r\n    },\r\n    forConfirm: (middleware: IMiddleware<Form>) => {\r\n      if (isFn(middleware)) {\r\n        env.confirmMiddlewares.push(middleware)\r\n      }\r\n      return formDialog\r\n    },\r\n    forCancel: (middleware: IMiddleware<Form>) => {\r\n      if (isFn(middleware)) {\r\n        env.cancelMiddlewares.push(middleware)\r\n      }\r\n      return formDialog\r\n    },\r\n    open: async (props: IFormProps) => {\r\n      if (env.promise) return env.promise\r\n      env.promise = new Promise(async (resolve, reject) => {\r\n        try {\r\n          props = await loading(dialogProps.loadingText, () =>\r\n            applyMiddleware(props, env.openMiddlewares)\r\n          )\r\n          env.form = env.form || createForm(props)\r\n        } catch (e) {\r\n          reject(e)\r\n        }\r\n\r\n        renderDialog(\r\n          true,\r\n          () => {\r\n            env.form\r\n              .submit(async () => {\r\n                await applyMiddleware(env.form, env.confirmMiddlewares)\r\n                resolve(toJS(env.form.values))\r\n                formDialog.close()\r\n              })\r\n              .catch(reject)\r\n          },\r\n          async () => {\r\n            await loading(dialogProps.loadingText, () =>\r\n              applyMiddleware(env.form, env.cancelMiddlewares)\r\n            )\r\n            formDialog.close()\r\n          }\r\n        )\r\n      })\r\n      return env.promise\r\n    },\r\n    close: () => {\r\n      if (!env.root) return\r\n      renderDialog(false)\r\n    },\r\n  }\r\n  return formDialog\r\n}\r\n\r\n// eslint-disable-next-line vue/one-component-per-file\r\nconst DialogFooter = defineComponent({\r\n  name: 'DialogFooter',\r\n  setup(props, { slots }) {\r\n    return () => {\r\n      if (document.querySelector(`#${PORTAL_TARGET_NAME}`)) {\r\n        return h(\r\n          Teleport as any,\r\n          {\r\n            to: `#${PORTAL_TARGET_NAME}`,\r\n          },\r\n          slots\r\n        )\r\n      } else {\r\n        return null\r\n      }\r\n    }\r\n  },\r\n})\r\n\r\nFormDialog.Footer = DialogFooter\r\nFormDialog.Portal = createPortalProvider('form-dialog')\r\n\r\nexport default FormDialog\r\n"]}